# this

## 상황에 따라 달라지는 this

자바스크립트에서 this는 기본적으로 실행 컨텍스트가 생성될 때 함께 결정된다. this는 함수를 호출할 때 결정된다고 할 수 있다.

### 전역 공간에서의 this

- 전역 공간에서 this는 전역 객체를 가리킨다.
- 전역변수를 선언하면 자바스크립트 엔진은 이를 전역객체의 프로퍼티로도 할당한다.
- 자바스크립트의 모든 변수는 실은 특정 객체의 프로퍼티로서 동작한다.
- 처음부터 전역객체의 프로퍼티로 할당한 경우에는 삭제가 되지만, 전역변수로 선언하여 프로퍼티가 된 경우는 삭제되지 않는다. 이는 전역변수를 선언하면 자바스크립트 엔진이 이를 자동으로 전역객체의 프로퍼티로 할당하면서 추가적으로 해당 프로퍼티의 configurable 속성을 false로 정의해서 그렇다.

### 메서드로서 호출할 때 그 메서드 내부에서의 this

함수 vs 메서드

- 이 둘을 구분하는 유일한 차이는 독립성에 있다. 함수는 그 자체로 독립적인 기능을 수행하는 반면, 메서드는 자신을 호출한 대상 객체에 관한 동작을 수행한다.
- 어떤 함수를 객체의 프로퍼티에 할당한다고 해서 그 자체로서 무조건 메서드가 되는 것이 아니라 객체의 메서드로서 호출할 경우에만 메서드로 동작하고, 그렇지 않으면 함수로 동작한다.
- 어떤 함수를 호출할 때 그 함수 이름 앞에 객체가 명시돼 있는 경우에는 메서드로 호출한 것이고, 그렇지 않은 모든 경우에는 함수로 호출한 것이다.

메서드 내부에서의 this

- this에는 호출한 주체에 대한 정보가 담긴다.
- 점 표기법의 경우 마지막 점 앞에 명시된 객체가 this가 된다.

#### this를 바인딩하지 않는 함수 (화살표 함수)

- ES6에서는 함수 내부에서 this가 전역객체를 바라보는 문제를 보완하고자, this를 바인딩하지 않는 화살표 함수를 새로 도입했다.
- 화살표 함수는 실행 컨텍스트를 생성할 때 this 바인딩 과정 자체가 빠지게 되어, 상위 스코프의 this를 그대로 활용할 수 있다.
- 함수 내부에 this가 아예 없으며, 접근하고자 하면 스코프체인상 가장 가까운 this에 접근하게 된다.

### 콜백 함수 호출 시 그 함수 내부에서의 this

- 콜백 함수도 함수이기 때문에 기본적으로 this가 전역객체를 참조하지만, 제어권을 받은 함수에서 콜백 함수에 별도로 this가 될 대상을 지정한 경우에는 그 대상을 참조하게 된다.
- 콜백 함수의 this는 '무조건 이거다!'라고 정의할 수 없다. 콜백 함수의 제어권을 가지는 함수가 콜백 함수에서의 this를 무엇으로 할지를 결정하며, 특별히 정의하지 않은 경우에는 기본적으로 함수와 마찬가지로 전역객체를 바라본다.

### 생성자 함수 내부에서의 this

- 프로그래밍적으로 '생성자'는 구체적인 인스턴스를 만들기 위한 일종의 틀이다.
- 어떤 함수가 생성자 함수로서 호출된 경우 내부에서의 this는 곧 새로 만들 구체적인 인스턴스 자신이 된다.

생성자 함수를 호출하면

1. 우선 생성자의 prototype 프로퍼티를 참조하는 `__proto__`라는 프로퍼티가 있는 객체(인스턴스)를 만들고
2. 미리 준비된 공통 속성 및 개성을 해당 객체(this)에 부여한다.

## 명시적으로 this를 바인딩하는 방법

### call 메서드

- call 메서드는 메서드의 호출 주체인 함수를 즉시 실행하도록 하는 명령이다.
- 함수를 그냥 실행하면 this는 전역객체를 참조하지만 call 메서드를 이용하면 임의의 객체를 this로 지정할 수 있다.

### apply 메서드

- apply 메서드는 call 메서드와 기능적으로 완전히 동일하다.

## call / apply 메서드의 활용

객체에는 배열 메서드를 직접 사용할 수 없지만, 키가 0 또는 양의 정수인 프로퍼티가 존재하고 length 프로퍼티의 값이 0 또는 양의 정수인 객체 (유사배열객체)는 call/apply 메서드를 이용해 배열 메서드를 차용할 수 있다. 단 문자열은 length 프로퍼티가 읽기 전용이기 때문에 원본 문자열에 변경을 가하는 메서드는 에러를 던진다. 유사배열객체는 Array.from 사용 가능.

## 생성자 내부에서 다른 생성자를 호출

생성자 내부에 다른 생성자와 공통된 내용이 있을 경우 call 또는 apply를 이용해 다른 생성자를 호출하면 간단하게 반복을 줄일 수 있다.

## bind 메서드

- call과 비슷하지만 즉시 호출하지는 않고 넘겨받은 this 및 인수들을 바탕으로 새로운 함수를 반환하기만 하는 메서드이다.
- 함수에 this를 미리 적용하는 것과 부분 적용 함수를 구현하는 두 가지 목적을 가진다.
- bind 메서드 적용하여 만든 함수는 bound라는 접두어가 name 프로퍼티에 붙는다.

### 상위 컨텍스트의 this를 내부함수나 콜백 함수에 전달하기

- 기본적으로 콜백 함수 내에서의 this에 관여하는 함수 또는 메서드에 대해서도 bind 메서드를 이용하면 this 값을 사용자의 입맛에 맞게 바꿀 수 있다.
